<!DOCTYPE html>
<head>
   <link rel="stylesheet" href="http://cdn.leafletjs.com/leaflet-0.5/leaflet.css" />
   <script src="http://cdn.leafletjs.com/leaflet-0.5/leaflet.js"></script>
   <script src="leaflet-heat.js"></script>
    <script src='Leaflet.js'></script>
</head>
<body>

        <div id="map" style="width: 960px; height: 500px"></div>

<script>

var map = L.map('map').setView([51.25, 71.5], 10);

L.tileLayer('http://{s}.tile.stamen.com/terrain/{z}/{x}/{y}.jpg', {maxZoom: 18}).addTo(map);
var heat = L.heatLayer([], {radius: 25}).addTo(map);

function click(e){
    var coord = e.latlng.toString().split(',');
    var lat = coord[0].split('(');
	var lng = coord[1].split(')');
	console.log("You clicked the map at latitude: " + lat[1] + " and longitude:" + lng[0]);

    const xhr = new XMLHttpRequest();

    xhr.open("GET", ("http://127.0.0.1:8000/getcar/MX1J7AGGXPK052972/"+lat[1]+"/"+lng[0]).replace(" ",""));
    xhr.setRequestHeader("Access-Control-Allow-Origin", "http://127.0.0.1:8000");
    xhr.send();
    xhr.responseType = "json";
    xhr.onload = () => {
    if (xhr.readyState == 4 && xhr.status == 200) {
      data = JSON.parse(xhr.response);
      console.log(data);

      map.eachLayer(function (layer) {
        map.removeLayer(layer);
      });

      var heat = L.heatLayer(data, {radius: 25}).addTo(map);

    } else {
      console.log(`Error: ${xhr.status}`);
    }

};

};
map.on('mousedown', click)

</script>

</body>